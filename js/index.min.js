window.onload=function(){var e=document.getElementsByClassName("start")[0],m=document.getElementsByClassName("tips")[0];e.onclick=function(){m.style.display="none",this.style.display="none",Game.init()}};var Game={enemy:{em1:{style:"enemy1",hp:"1",score:"3",scorePlus:2,speed:2},em2:{style:"enemy2",hp:"2",score:"5",scorePlus:3,speed:4},em3:{style:"enemy3",hp:"4",score:"8",scorePlus:7,speed:6},em4:{style:"enemy4",hp:"9",score:"15",scorePlus:10,speed:8},em5:{style:"enemy5",hp:"17",score:"20",scorePlus:15,speed:8}},checkpoint:[{data:["em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:5,speedY:5,timer:5e3,lottery:[20,20,10,50]},{data:["em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em4","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:7,speedY:10,timer:4e3,lottery:[25,25,10,40]},{data:["em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em4","em1","em4","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em5","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:10,speedY:20,timer:3e3,lottery:[30,30,10,30]},{data:["em3","em4","em3","em4","em3","em4","em3","em4","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em5","em2","em5","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em5","em1","em1","em1"],iNum:10,speedX:15,speedY:25,timer:2500,lottery:[30,20,20,30]},{data:["em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em5","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1"],iNum:10,speedX:20,speedY:30,timer:2e3,lottery:[30,25,30,15]},{data:["em4","em4","em4","em4","em4","em4","em4","em4","em4","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2"],iNum:10,speedX:18,speedY:35,timer:1500,lottery:[30,15,35,10]},{data:["em4","em4","em4","em4","em4","em4","em4","em5","em4","em4","em3","em5","em5","em4","em5","em4","em5","em4","em5","em4","em5","em4","em5","em4","em5","em4","em5","em4","em5","em4","em5","em5","em5","em5","em5","em5","em5","em5","em5","em5","em5","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em3","em3","em2","em2","em2","em5","em2","em2","em2","em2","em3","em2","em3","em2","em2","em2","em2","em2"],iNum:10,speedX:20,speedY:35,timer:1500,lottery:[40,20,40,0]}],airData:{air1:{style:"air",speed:5,bullet:"bullet",bulletNum:1,hp:1}},level:0,maxLevel:5,init:function(){this.createScore(),this.createEnemy(this.checkpoint[this.level]),this.createAir(),this.maxLevel=this.checkpoint.length,this.level++},createScore:function(){var e=document.createElement("div"),m=document.getElementsByClassName("box")[0];this.oBox=m,e.className="score",e.innerHTML="积分：<span>0</span>",m.appendChild(e);var t=e.getElementsByTagName("span")[0];this.oSore=t},createLottery:function(e){var m=this,t=0,o=0;this.lotteryArr=[];document.createElement("div").className="lottery",this.oUl.lotteryTimer=null,this.oUl.lotteryTimer=setTimeout(function(){var i=document.createElement("div");i.className="lottery";var l=Math.ceil(100*Math.random());o=Math.ceil(100*Math.random()),l<=e.lottery[0]?(i.innerText="墙",m.oBox.appendChild(i),t=(m.oBox.offsetWidth-i.offsetWidth)/m.oBox.offsetWidth*100,o=Math.ceil(Math.random()*t),i.style.left=o+"%",i.style.top=0,i.timer=null,i.timer=setInterval(function(){i.style.top=i.offsetTop+8+"px",m.collision1(i,m.oAir)&&(1==m.oAir.innerText?(clearInterval(m.oUl.rdTiemr),clearInterval(m.oUl.timer),document.getElementsByClassName("end")[0].innerText="游戏失败",document.getElementsByClassName("end")[0].style.display="block",setTimeout(function(){window.location.reload()},2e3)):(m.oAir.innerText--,clearInterval(i.timer),m.oBox.removeChild(i))),i.offsetTop>=m.oBox.offsetHeight&&(clearInterval(i.timer),m.oBox.removeChild(i))},80)):l<=e.lottery[0]+e.lottery[1]?(i.innerText="血",m.oBox.appendChild(i),t=(m.oBox.offsetWidth-i.offsetWidth)/m.oBox.offsetWidth*100,o=Math.ceil(Math.random()*t),i.style.left=o+"%",i.style.top=0,i.timer=null,i.timer=setInterval(function(){i.style.top=i.offsetTop+8+"px",m.collision1(i,m.oAir)&&(m.oAir.innerText++,clearInterval(i.timer),m.oBox.removeChild(i)),i.offsetTop>=m.oBox.offsetHeight&&(clearInterval(i.timer),m.oBox.removeChild(i))},80)):l<=e.lottery[0]+e.lottery[1]+e.lottery[2]?(i.innerText="弹",m.oBox.appendChild(i),t=(m.oBox.offsetWidth-i.offsetWidth)/m.oBox.offsetWidth*100,o=Math.ceil(Math.random()*t),i.style.left=o+"%",i.style.top=0,i.timer=null,i.timer=setInterval(function(){i.style.top=i.offsetTop+8+"px",m.collision1(i,m.oAir)&&(m.oAir.bulletNum++,clearInterval(i.timer),m.oBox.removeChild(i)),i.offsetTop>=m.oBox.offsetHeight&&(clearInterval(i.timer),m.oBox.removeChild(i))},80)):l<=e.lottery[0]+e.lottery[1]+e.lottery[2]+e.lottery[3]&&console.log("空")},5e3)},createEnemy:function(e){var m=e.data,t=[],o=this;document.title=this.level+1;var i=document.createElement("ul");i.style.width=20*e.iNum+"px",i.className="honeycomb",this.oUl=i,this.oUl.rdTiemr=null,this.oBox.appendChild(i),i.style.left=(this.oBox.offsetWidth-i.offsetWidth)/2+"px";for(var l=0;l<m.length;l++){var s=Math.random();(r=document.createElement("li")).className=this.enemy[m[l]].style,r.hp=this.enemy[m[l]].hp,r.score=parseInt(this.enemy[m[l]].score)+parseInt(this.enemy[m[l]].scorePlus*s),r.speed=this.enemy[m[l]].speed,i.appendChild(r)}var r=i.getElementsByTagName("li");this.oLi=r;for(var n=0;n<r.length;n++)t.push([r[n].offsetLeft,r[n].offsetTop]);for(var a=0;a<r.length;a++)r[a].style.position="absolute",r[a].style.left=t[a][0]+"px",r[a].style.top=t[a][1]+"px";this.enemyMove(e),this.oUl.rdTiemr=setInterval(function(){o.random()},e.timer),this.createLottery(e)},enemyMove:function(e){var m=this;m.oUl.timer=null;var t=0,o=this.oBox.offsetWidth-this.oUl.offsetWidth;m.oUl.timer=setInterval(function(){m.oUl.offsetLeft>=o?(e.speedX*=-1,m.oUl.style.top=m.oUl.offsetTop+e.speedY+"px"):m.oUl.offsetLeft<=t&&(e.speedX*=-1,m.oUl.style.top=m.oUl.offsetTop+e.speedY+"px"),m.oUl.style.left=m.oUl.offsetLeft+e.speedX+"px"},1e3)},createAir:function(){var e=this,m=document.createElement("div");m.className=this.airData.air1.style,m.speed=this.airData.air1.speed,m.hp=this.airData.air1.hp,m.bulletNum=this.airData.air1.bulletNum,m.innerText=m.hp,m.blTimer=null,this.oAir=m,this.oBox.appendChild(m),m.style.left=(this.oBox.offsetWidth-m.offsetWidth)/2+"px",m.style.top=this.oBox.offsetHeight-m.offsetHeight+"px",this.airMove(),m.blTimer=setInterval(function(){for(var m=0;m<e.oAir.bulletNum;m++)e.createBullet()},400)},airMove:function(){function e(){1==t?m.oAir.offsetLeft>=0?m.oAir.style.left=m.oAir.offsetLeft-m.oAir.speed+"px":clearInterval(m.oAir.timer):2==t&&(m.oAir.offsetLeft<=m.oBox.offsetWidth-m.oAir.offsetWidth?m.oAir.style.left=m.oAir.offsetLeft+m.oAir.speed+"px":clearInterval(m.oAir.timer))}var m=this;this.oAir.timer=null;var t=0,o=document.getElementsByClassName("btn")[0];o.ontouchstart=function(o){m.oAir.timer||(m.oAir.timer=setInterval(e,1e3/60)),"left"==o.target.className?t=1:"right"==o.target.className&&(t=2)},o.ontouchend=function(e){"left"==e.target.className?(clearInterval(m.oAir.timer),t=0,m.oAir.timer=null):"right"==e.target.className?(clearInterval(m.oAir.timer),t=0,m.oAir.timer=null):"hp"==e.target.className&&m.oSore.innerText>=100?(m.oSore.innerText-=100,m.oAir.innerText++):"bl"==e.target.className&&m.oSore.innerText>=300&&(m.oSore.innerText-=300,m.oAir.bulletNum++)}},createBullet:function(){var e=document.createElement("div");e.className="bullet",this.oBox.appendChild(e),e.style.left=this.oAir.offsetLeft+this.oAir.offsetWidth/2-e.offsetWidth/2+"px",e.style.top=this.oBox.offsetHeight-this.oAir.offsetHeight-e.offsetHeight-4+"px",this.bulletMove(e)},bulletMove:function(e){var m=this;e.timer=null,e.timer=setInterval(function(){e.offsetTop<=m.oBox.offsetTop-e.offsetHeight?(clearInterval(e.timer),m.oBox.removeChild(e)):e.style.top=e.offsetTop-20+"px";for(var t=0;t<m.oLi.length;t++)if(m.collision(e,m.oLi[t])){if(1==m.oLi[t].hp){var o=document.createElement("span");o.className="scoretext",o.style.left=e.offsetLeft+"px",o.style.top=e.offsetTop+"px",o.innerText="+"+parseInt(m.oLi[t].score),m.oBox.appendChild(o),setTimeout(function(){m.oBox.removeChild(o)},800),m.oSore.innerText=parseInt(m.oSore.innerText)+parseInt(m.oLi[t].score),clearInterval(m.oLi[t].timer),m.oUl.removeChild(m.oLi[t])}else m.oLi[t].hp--;clearInterval(e.timer),m.oBox.removeChild(e),m.nextCheckpoint()}},2e3/60)},random:function(){var e=this,m=this.oLi[parseInt(this.oLi.length*Math.random())];m.timer=null,m.timer=setInterval(function(){var t=e.oAir.offsetLeft+e.oAir.offsetWidth/2-(m.offsetLeft+e.oUl.offsetLeft+m.offsetWidth/2),o=e.oAir.offsetTop+e.oAir.offsetHeight/2-(m.offsetTop+e.oUl.offsetTop+m.offsetHeight/2),i=Math.sqrt(t*t+o*o),l=m.speed*t/i,s=m.speed*o/i;m.style.left=m.offsetLeft+l+"px",m.style.top=m.offsetTop+s+"px",e.collision(e.oAir,m)&&(1==e.oAir.innerText?(clearInterval(e.oUl.rdTiemr),clearInterval(e.oUl.timer),document.getElementsByClassName("end")[0].innerText="游戏失败",document.getElementsByClassName("end")[0].style.display="block",clearInterval(e.oAir.blTimer),e.oBox.removeChild(e.oAir),clearInterval(m.timer),e.oAir=null,e.oUl.removeChild(m),setTimeout(function(){window.location.reload()},2e3)):(clearInterval(m.timer),e.oUl.removeChild(m),m=null,e.oAir.innerText--,e.nextCheckpoint()))},2e3/60)},nextCheckpoint:function(){0==this.oLi.length&&(this.level==this.maxLevel?(clearInterval(this.oUl.rdTiemr),clearInterval(this.oUl.timer),this.oBox.removeChild(this.oUl),document.getElementsByClassName("end")[0].style.display="block",clearInterval(this.oAir.blTimer),this.oBox.removeChild(this.oAir)):(clearInterval(this.oUl.rdTiemr),clearInterval(this.oUl.timer),this.oBox.removeChild(this.oUl),this.createEnemy(this.checkpoint[this.level]),this.level++))},collision:function(e,m){var t=e.offsetLeft,o=e.offsetLeft+e.offsetWidth,i=e.offsetTop,l=e.offsetTop+e.offsetHeight,s=m.offsetLeft+this.oUl.offsetLeft,r=m.offsetLeft+this.oUl.offsetLeft+m.offsetWidth,n=m.offsetTop+this.oUl.offsetTop,a=m.offsetTop+this.oUl.offsetTop+m.offsetHeight;return!(t>r||o<s||i>a||l<n)},collision1:function(e,m){if(null!=e&&null!=m){var t=e.offsetLeft,o=e.offsetLeft+e.offsetWidth,i=e.offsetTop,l=e.offsetTop+e.offsetHeight,s=m.offsetLeft,r=m.offsetLeft+m.offsetWidth,n=m.offsetTop,a=m.offsetTop+m.offsetHeight;return!(t>r||o<s||i>a||l<n)}}};