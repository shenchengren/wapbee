window.onload=function(){var e=document.getElementsByClassName("start")[0],m=document.getElementsByClassName("tips")[0];e.onclick=function(){m.style.display="none",this.style.display="none",Game.init()}};var Game={enemy:{em1:{style:"enemy1",hp:"1",score:"3",scorePlus:2,speed:2},em2:{style:"enemy2",hp:"2",score:"5",scorePlus:5,speed:4},em3:{style:"enemy3",hp:"3",score:"10",scorePlus:10,speed:8},em4:{style:"enemy4",hp:"5",score:"20",scorePlus:15,speed:16}},checkpoint:[{data:["em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:5,speedY:5,timer:5e3},{data:["em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:7,speedY:10,timer:4e3},{data:["em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:10,speedY:20,timer:3e3},{data:["em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:15,speedY:25,timer:2500},{data:["em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1"],iNum:10,speedX:25,speedY:40,timer:2e3},{data:["em4","em4","em4","em4","em4","em4","em4","em4","em4","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2"],iNum:10,speedX:25,speedY:40,timer:1500}],airData:{air1:{style:"air",speed:5,bullet:"bullet",bulletNum:1,hp:1}},tipsData:["左右移动 ← →，","空格 开枪，","强化生命（100）：↑，","强化飞机（300）：↓"],level:0,maxLevel:5,init:function(){this.createScore(),this.createEnemy(this.checkpoint[this.level]),this.createAir(),this.maxLevel=this.checkpoint.length,this.level++},createScore:function(){var e=document.createElement("div"),m=document.getElementsByClassName("box")[0];this.oBox=m,e.className="score",e.innerHTML="积分：<span>0</span>",m.appendChild(e);var t=e.getElementsByTagName("span")[0];this.oSore=t},createEnemy:function(e){var m=e.data,t=[],o=this;document.title=this.level+1;var s=document.createElement("ul");s.style.width=20*e.iNum+"px",s.className="honeycomb",this.oUl=s,this.oUl.rdTiemr=null,this.oBox.appendChild(s),s.style.left=(this.oBox.offsetWidth-s.offsetWidth)/2+"px";for(var i=0;i<m.length;i++){var l=Math.random();(r=document.createElement("li")).className=this.enemy[m[i]].style,r.hp=this.enemy[m[i]].hp,r.score=parseInt(this.enemy[m[i]].score)+parseInt(this.enemy[m[i]].scorePlus*l),r.speed=this.enemy[m[i]].speed,s.appendChild(r)}var r=s.getElementsByTagName("li");this.oLi=r;for(var a=0;a<r.length;a++)t.push([r[a].offsetLeft,r[a].offsetTop]);for(var n=0;n<r.length;n++)r[n].style.position="absolute",r[n].style.left=t[n][0]+"px",r[n].style.top=t[n][1]+"px";this.enemyMove(e),this.oUl.rdTiemr=setInterval(function(){o.random()},e.timer)},enemyMove:function(e){var m=this;m.oUl.timer=null;var t=0,o=this.oBox.offsetWidth-this.oUl.offsetWidth;m.oUl.timer=setInterval(function(){m.oUl.offsetLeft>=o?(e.speedX*=-1,m.oUl.style.top=m.oUl.offsetTop+e.speedY+"px"):m.oUl.offsetLeft<=t&&(e.speedX*=-1,m.oUl.style.top=m.oUl.offsetTop+e.speedY+"px"),m.oUl.style.left=m.oUl.offsetLeft+e.speedX+"px"},1e3)},createAir:function(){var e=this,m=document.createElement("div");m.className=this.airData.air1.style,m.speed=this.airData.air1.speed,m.hp=this.airData.air1.hp,m.bulletNum=this.airData.air1.bulletNum,m.innerText=m.hp,m.blTimer=null,this.oAir=m,this.oBox.appendChild(m),m.style.left=(this.oBox.offsetWidth-m.offsetWidth)/2+"px",m.style.top=this.oBox.offsetHeight-m.offsetHeight+"px",this.airMove(),m.blTimer=setInterval(function(){for(var m=0;m<e.oAir.bulletNum;m++)e.createBullet()},400)},airMove:function(){function e(){1==t?m.oAir.offsetLeft>=0?m.oAir.style.left=m.oAir.offsetLeft-m.oAir.speed+"px":clearInterval(m.oAir.timer):2==t&&(m.oAir.offsetLeft<=m.oBox.offsetWidth-m.oAir.offsetWidth?m.oAir.style.left=m.oAir.offsetLeft+m.oAir.speed+"px":clearInterval(m.oAir.timer))}var m=this;this.oAir.timer=null;var t=0,o=document.getElementsByClassName("btn")[0];o.ontouchstart=function(o){m.oAir.timer||(m.oAir.timer=setInterval(e,1e3/60)),"left"==o.target.className?t=1:"right"==o.target.className&&(t=2)},o.ontouchend=function(e){"left"==e.target.className?(clearInterval(m.oAir.timer),t=0,m.oAir.timer=null):"right"==e.target.className?(clearInterval(m.oAir.timer),t=0,m.oAir.timer=null):"hp"==e.target.className&&m.oSore.innerText>=100?(m.oSore.innerText-=100,m.oAir.innerText++):"bl"==e.target.className&&m.oSore.innerText>=300&&(m.oSore.innerText-=300,m.oAir.bulletNum++)}},createBullet:function(){var e=document.createElement("div");e.className="bullet",this.oBox.appendChild(e),e.style.left=this.oAir.offsetLeft+this.oAir.offsetWidth/2-e.offsetWidth/2+"px",e.style.top=this.oBox.offsetHeight-this.oAir.offsetHeight-e.offsetHeight-4+"px",this.bulletMove(e)},bulletMove:function(e){var m=this;e.timer=null,e.timer=setInterval(function(){e.offsetTop<=m.oBox.offsetTop-e.offsetHeight?(clearInterval(e.timer),m.oBox.removeChild(e)):e.style.top=e.offsetTop-20+"px";for(var t=0;t<m.oLi.length;t++)if(m.collision(e,m.oLi[t])){if(1==m.oLi[t].hp){var o=document.createElement("span");o.className="scoretext",o.style.left=e.offsetLeft+"px",o.style.top=e.offsetTop+"px",o.innerText="+"+parseInt(m.oLi[t].score),m.oBox.appendChild(o),setTimeout(function(){m.oBox.removeChild(o)},800),m.oSore.innerText=parseInt(m.oSore.innerText)+parseInt(m.oLi[t].score),clearInterval(m.oLi[t].timer),m.oUl.removeChild(m.oLi[t])}else m.oLi[t].hp--;clearInterval(e.timer),m.oBox.removeChild(e),0==m.oLi.length&&(m.level==m.maxLevel?(clearInterval(m.oUl.rdTiemr),clearInterval(m.oUl.timer),m.oBox.removeChild(m.oUl),document.getElementsByClassName("end")[0].style.display="block"):(clearInterval(m.oUl.rdTiemr),clearInterval(m.oUl.timer),m.oBox.removeChild(m.oUl),m.createEnemy(m.checkpoint[m.level]),m.level++))}},2e3/60)},random:function(){var e=this,m=this.oLi[parseInt(this.oLi.length*Math.random())];m.timer=null,m.timer=setInterval(function(){var t=e.oAir.offsetLeft+e.oAir.offsetWidth/2-(m.offsetLeft+e.oUl.offsetLeft+m.offsetWidth/2),o=e.oAir.offsetTop+e.oAir.offsetHeight/2-(m.offsetTop+e.oUl.offsetTop+m.offsetHeight/2),s=Math.sqrt(t*t+o*o),i=m.speed*t/s,l=m.speed*o/s;m.style.left=m.offsetLeft+i+"px",m.style.top=m.offsetTop+l+"px",e.collision(e.oAir,m)&&(1==e.oAir.innerText?(clearInterval(e.oUl.rdTiemr),clearInterval(e.oUl.timer),document.getElementsByClassName("end")[0].innerText="游戏失败",document.getElementsByClassName("end")[0].style.display="block",setTimeout(function(){window.location.reload()},2e3)):(clearInterval(m.timer),e.oUl.removeChild(m),e.oAir.innerText--,0==e.oLi.length&&(e.level==e.maxLevel?(clearInterval(e.oUl.rdTiemr),clearInterval(e.oUl.timer),e.oBox.removeChild(e.oUl),document.getElementsByClassName("end")[0].style.display="block"):(clearInterval(e.oUl.rdTiemr),clearInterval(e.oUl.timer),e.oBox.removeChild(e.oUl),e.createEnemy(e.checkpoint[e.level]),e.level++))))},2e3/60)},collision:function(e,m){var t=e.offsetLeft,o=e.offsetLeft+e.offsetWidth,s=e.offsetTop,i=e.offsetTop+e.offsetHeight,l=m.offsetLeft+this.oUl.offsetLeft,r=m.offsetLeft+this.oUl.offsetLeft+m.offsetWidth,a=m.offsetTop+this.oUl.offsetTop,n=m.offsetTop+this.oUl.offsetTop+m.offsetHeight;return!(t>r||o<l||s>n||i<a)}};